{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _classCallCheck = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _assertThisInitialized = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/assertThisInitialized.js\").default;\nvar _get = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/get.js\").default;\nvar _getPrototypeOf = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/getPrototypeOf.js\").default;\nvar _inherits = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar _classPrivateFieldInitSpec = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _classPrivateFieldSet = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/classPrivateFieldSet.js\").default;\nvar _classPrivateFieldGet = require(\"/Users/aryanbindroo/eth-waterloo/frontend/node_modules/@babel/runtime/helpers/classPrivateFieldGet.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebSocketProvider = void 0;\nvar ws_js_1 = require(\"./ws.js\"); /*-browser*/\nvar provider_socket_js_1 = require(\"./provider-socket.js\");\n/**\n *  A JSON-RPC provider which is backed by a WebSocket.\n *\n *  WebSockets are often preferred because they retain a live connection\n *  to a server, which permits more instant access to events.\n *\n *  However, this incurs higher server infrasturture costs, so additional\n *  resources may be required to host your own WebSocket nodes and many\n *  third-party services charge additional fees for WebSocket endpoints.\n */\nvar _connect = /*#__PURE__*/new WeakMap();\nvar _websocket = /*#__PURE__*/new WeakMap();\nvar WebSocketProvider = /*#__PURE__*/function (_provider_socket_js_) {\n  _inherits(WebSocketProvider, _provider_socket_js_);\n  var _super = _createSuper(WebSocketProvider);\n  function WebSocketProvider(url, network) {\n    var _this;\n    _classCallCheck(this, WebSocketProvider);\n    _this = _super.call(this, network);\n    _classPrivateFieldInitSpec(_assertThisInitialized(_this), _connect, {\n      writable: true,\n      value: void 0\n    });\n    _classPrivateFieldInitSpec(_assertThisInitialized(_this), _websocket, {\n      writable: true,\n      value: void 0\n    });\n    if (typeof url === \"string\") {\n      _classPrivateFieldSet(_assertThisInitialized(_this), _connect, function () {\n        return new ws_js_1.WebSocket(url);\n      });\n      _classPrivateFieldSet(_assertThisInitialized(_this), _websocket, _classPrivateFieldGet(_assertThisInitialized(_this), _connect).call(_assertThisInitialized(_this)));\n    } else if (typeof url === \"function\") {\n      _classPrivateFieldSet(_assertThisInitialized(_this), _connect, url);\n      _classPrivateFieldSet(_assertThisInitialized(_this), _websocket, url());\n    } else {\n      _classPrivateFieldSet(_assertThisInitialized(_this), _connect, null);\n      _classPrivateFieldSet(_assertThisInitialized(_this), _websocket, url);\n    }\n    _this.websocket.onopen = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _this._start();\n          case 3:\n            _this.resume();\n            _context.next = 9;\n            break;\n          case 6:\n            _context.prev = 6;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(\"failed to start WebsocketProvider\", _context.t0);\n            // @TODO: now what? Attempt reconnect?\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[0, 6]]);\n    }));\n    _this.websocket.onmessage = function (message) {\n      _this._processMessage(message.data);\n    };\n    /*\n            this.websocket.onclose = (event) => {\n                // @TODO: What event.code should we reconnect on?\n                const reconnect = false;\n                if (reconnect) {\n                    this.pause(true);\n                    if (this.#connect) {\n                        this.#websocket = this.#connect();\n                        this.#websocket.onopen = ...\n                        // @TODO: this requires the super class to rebroadcast; move it there\n                    }\n                    this._reconnect();\n                }\n            };\n    */\n    return _this;\n  }\n  _createClass(WebSocketProvider, [{\n    key: \"websocket\",\n    get: function get() {\n      if (_classPrivateFieldGet(this, _websocket) == null) {\n        throw new Error(\"websocket closed\");\n      }\n      return _classPrivateFieldGet(this, _websocket);\n    }\n  }, {\n    key: \"_write\",\n    value: function () {\n      var _write2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(message) {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              this.websocket.send(message);\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function _write(_x) {\n        return _write2.apply(this, arguments);\n      }\n      return _write;\n    }()\n  }, {\n    key: \"destroy\",\n    value: function () {\n      var _destroy = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (_classPrivateFieldGet(this, _websocket) != null) {\n                _classPrivateFieldGet(this, _websocket).close();\n                _classPrivateFieldSet(this, _websocket, null);\n              }\n              _get(_getPrototypeOf(WebSocketProvider.prototype), \"destroy\", this).call(this);\n            case 2:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function destroy() {\n        return _destroy.apply(this, arguments);\n      }\n      return destroy;\n    }()\n  }]);\n  return WebSocketProvider;\n}(provider_socket_js_1.SocketProvider);\nexports.WebSocketProvider = WebSocketProvider;","map":{"version":3,"names":["ws_js_1","require","provider_socket_js_1","_connect","WeakMap","_websocket","WebSocketProvider","_provider_socket_js_","_inherits","_super","_createSuper","url","network","_this","_classCallCheck","call","_classPrivateFieldInitSpec","_assertThisInitialized","writable","value","_classPrivateFieldSet","WebSocket","_classPrivateFieldGet","websocket","onopen","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","_start","resume","t0","console","log","stop","onmessage","message","_processMessage","data","_createClass","key","get","Error","_write2","_callee2","_callee2$","_context2","send","_write","_x","apply","arguments","_destroy","_callee3","_callee3$","_context3","close","_get","_getPrototypeOf","prototype","destroy","SocketProvider","exports"],"sources":["/Users/aryanbindroo/eth-waterloo/frontend/node_modules/ethers/src.ts/providers/provider-websocket.ts"],"sourcesContent":["\n\nimport { WebSocket as _WebSocket } from \"./ws.js\"; /*-browser*/\n\nimport { SocketProvider } from \"./provider-socket.js\";\n\nimport type { Networkish } from \"./network.js\";\n\n/**\n *  A generic interface to a Websocket-like object.\n */\nexport interface WebSocketLike {\n    onopen: null | ((...args: Array<any>) => any);\n    onmessage: null | ((...args: Array<any>) => any);\n    onerror: null | ((...args: Array<any>) => any);\n\n    readyState: number;\n\n    send(payload: any): void;\n    close(code?: number, reason?: string): void;\n}\n\n/**\n *  A function which can be used to re-create a WebSocket connection\n *  on disconnect.\n */\nexport type WebSocketCreator = () => WebSocketLike;\n\n/**\n *  A JSON-RPC provider which is backed by a WebSocket.\n *\n *  WebSockets are often preferred because they retain a live connection\n *  to a server, which permits more instant access to events.\n *\n *  However, this incurs higher server infrasturture costs, so additional\n *  resources may be required to host your own WebSocket nodes and many\n *  third-party services charge additional fees for WebSocket endpoints.\n */\nexport class WebSocketProvider extends SocketProvider {\n    #connect: null | WebSocketCreator;\n\n    #websocket: null | WebSocketLike;\n    get websocket(): WebSocketLike {\n        if (this.#websocket == null) { throw new Error(\"websocket closed\"); }\n        return this.#websocket;\n    }\n\n    constructor(url: string | WebSocketLike | WebSocketCreator, network?: Networkish) {\n        super(network);\n        if (typeof(url) === \"string\") {\n            this.#connect = () => { return new _WebSocket(url); };\n            this.#websocket = this.#connect();\n        } else if (typeof(url) === \"function\") {\n            this.#connect = url;\n            this.#websocket = url();\n        } else {\n            this.#connect = null;\n            this.#websocket = url;\n        }\n\n        this.websocket.onopen = async () => {\n            try {\n                await this._start()\n                this.resume();\n            } catch (error) {\n                console.log(\"failed to start WebsocketProvider\", error);\n                // @TODO: now what? Attempt reconnect?\n            }\n        };\n\n        this.websocket.onmessage = (message: { data: string }) => {\n            this._processMessage(message.data);\n        };\n/*\n        this.websocket.onclose = (event) => {\n            // @TODO: What event.code should we reconnect on?\n            const reconnect = false;\n            if (reconnect) {\n                this.pause(true);\n                if (this.#connect) {\n                    this.#websocket = this.#connect();\n                    this.#websocket.onopen = ...\n                    // @TODO: this requires the super class to rebroadcast; move it there\n                }\n                this._reconnect();\n            }\n        };\n*/\n    }\n\n    async _write(message: string): Promise<void> {\n        this.websocket.send(message);\n    }\n\n    async destroy(): Promise<void> {\n        if (this.#websocket != null) {\n            this.#websocket.close();\n            this.#websocket = null;\n        }\n        super.destroy();\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}